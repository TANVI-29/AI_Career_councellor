{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Career Assessment - AI Career Counselor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .progress-bar {
            transition: width 0.3s ease;
        }
        
        .question-card {
            transform: translateY(20px);
            opacity: 0;
            animation: slideIn 0.5s ease forwards;
        }
        
        @keyframes slideIn {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .textarea-focus:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            border: 2px solid #667eea;
            color: #667eea;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background-color: #667eea;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-xl">üéØ</span>
                    </div>
                    <span class="ml-3 text-xl font-bold text-gray-800">AI Career Assessment</span>
                </div>
                <div class="text-sm text-gray-600">
                    Question <span id="current-question">1</span> of <span id="total-questions">5</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="bg-white border-b">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="w-full bg-gray-200 rounded-full h-2">
                <div id="progress-bar" class="progress-bar bg-gradient-to-r from-purple-600 to-blue-600 h-2 rounded-full" style="width: 12.5%"></div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div id="assessment-container">
            <!-- Question 1 -->
            <div id="question-1" class="question-card bg-white rounded-xl shadow-lg p-8 mb-6">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-3">What are your main interests or hobbies?</h2>
                   
                </div>
                <textarea 
                    id="answer-1" 
                    class="textarea-focus w-full h-32 p-4 border-2 border-gray-300 rounded-lg resize-none focus:outline-none transition-all duration-200" 
                    placeholder="Share your interests, hobbies, and what you're passionate about..."
                ></textarea>
                <div class="text-sm text-gray-500 mt-2">
                    <span id="char-count-1">0</span>/500 characters
                </div>
            </div>

            <!-- Question 2 -->
            <div id="question-2" class="question-card bg-white rounded-xl shadow-lg p-8 mb-6 hidden">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-3">Which subjects or topics do you enjoy learning the most?</h2>
      
                </div>
                <textarea 
                    id="answer-2" 
                    class="textarea-focus w-full h-32 p-4 border-2 border-gray-300 rounded-lg resize-none focus:outline-none transition-all duration-200" 
                    placeholder="List your strengths, talents, and developed skills..."
                ></textarea>
                <div class="text-sm text-gray-500 mt-2">
                    <span id="char-count-2">0</span>/500 characters
                </div>
            </div>

            <!-- Question 3 -->
            <div id="question-3" class="question-card bg-white rounded-xl shadow-lg p-8 mb-6 hidden">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-3">What kind of tasks or activities do you enjoy doing?</h2>
 
                </div>
                <textarea 
                    id="answer-3" 
                    class="textarea-focus w-full h-32 p-4 border-2 border-gray-300 rounded-lg resize-none focus:outline-none transition-all duration-200" 
                    placeholder="Describe your preferred work environment and conditions..."
                ></textarea>
                <div class="text-sm text-gray-500 mt-2">
                    <span id="char-count-3">0</span>/500 characters
                </div>
            </div>

            <!-- Question 4 -->
            <div id="question-4" class="question-card bg-white rounded-xl shadow-lg p-8 mb-6 hidden">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-3">What are your strengths or skills that you feel confident about?</h2>
                   
                </div>
                <textarea 
                    id="answer-4" 
                    class="textarea-focus w-full h-32 p-4 border-2 border-gray-300 rounded-lg resize-none focus:outline-none transition-all duration-200" 
                    placeholder="Share your future goals and what you hope to achieve..."
                ></textarea>
                <div class="text-sm text-gray-500 mt-2">
                    <span id="char-count-4">0</span>/500 characters
                </div>
            </div>

            <!-- Question 5 -->
            <div id="question-5" class="question-card bg-white rounded-xl shadow-lg p-8 mb-6 hidden">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-3">What kind of work or projects would excite you in the future?</h2>
                
                </div>
                <textarea 
                    id="answer-5" 
                    class="textarea-focus w-full h-32 p-4 border-2 border-gray-300 rounded-lg resize-none focus:outline-none transition-all duration-200" 
                    placeholder="Describe the types of problems and challenges you find engaging..."
                ></textarea>
                <div class="text-sm text-gray-500 mt-2">
                    <span id="char-count-5">0</span>/500 characters
                </div>
            </div>

            <!-- Question 6 -->
            

            <!-- Question 7 -->
            

            
        </div>

        <!-- Navigation Buttons -->
        <div class="flex justify-between items-center mt-8">
            <button 
                id="prev-btn" 
                class="btn-secondary px-6 py-3 rounded-lg font-medium transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed" 
                disabled
            >
                ‚Üê Previous
            </button>
            
            <div class="flex space-x-4">
                <button 
                    id="save-draft-btn" 
                    class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition-all duration-200"
                >
                    Save Draft
                </button>
                
                <button 
                    id="next-btn" 
                    class="btn-primary px-6 py-3 text-white rounded-lg font-medium"
                >
                    Next ‚Üí
                </button>
            </div>
        </div>

        <!-- Completion Message -->
        <div id="completion-message" class="hidden bg-green-50 border border-green-200 rounded-xl p-8 text-center mt-8">
            <div class="text-4xl mb-4">üéâ</div>
            <h3 class="text-2xl font-bold text-green-800 mb-2">Assessment Complete!</h3>
            <p class="text-green-700 mb-6">Thank you for providing detailed responses. Our AI is now analyzing your answers to create personalized career recommendations.</p>
            <button 
                id="get-results-btn" 
                class="btn-primary px-8 py-3 text-white rounded-lg font-medium"
            >
                Get My Results
            </button>

             <!-- Django Recommendations -->
            <div id="career-results">
               {% if recommendations %}
                  <h2 class="text-xl font-bold text-gray-800 mb-4">Top Career Recommendations:</h2>
                  {% for rec in recommendations %}
                     <div class="mb-6 p-4 bg-white rounded-lg shadow">
                        <strong class="text-lg">{{ rec.career }} ({{ rec.confidence }}% confident)</strong>
                        <p class="text-gray-700 mt-2">{{ rec.description }}</p>
                    </div>
                  {% endfor %}
              {% endif %}
            </div>
        </div>
    </main>

    <script>
        let currentQuestion = 1;
const totalQuestions = 5;
const answers = {};

// Initialize first question
showQuestion(currentQuestion);

// Character counting for all textareas
for (let i = 1; i <= totalQuestions; i++) {
    const textarea = document.getElementById(`answer-${i}`);
    const charCount = document.getElementById(`char-count-${i}`);
    
    if (textarea && charCount) {
        textarea.addEventListener('input', function() {
            let length = this.value.length;
            if (length > 500) {
                this.value = this.value.substring(0, 500);
                length = 500;
            }
            charCount.textContent = length;
            charCount.classList.toggle('text-red-500', length >= 500);
            answers[i] = this.value;
        });
    }
}

// Show the current question
function showQuestion(questionNum) {
    for (let i = 1; i <= totalQuestions; i++) {
        const q = document.getElementById(`question-${i}`);
        if (q) q.style.display = i === questionNum ? 'block' : 'none';
    }

    // Update progress bar
    const progress = (questionNum / totalQuestions) * 100;
    document.getElementById('progress-bar').style.width = `${progress}%`;
    document.getElementById('current-question').textContent = questionNum;

    // Update buttons
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');

    prevBtn.disabled = questionNum === 1;

    if (questionNum === totalQuestions) {
        nextBtn.textContent = 'Complete Assessment';
        nextBtn.classList.add('bg-green-600', 'hover:bg-green-700');
        nextBtn.classList.remove('btn-primary');
    } else {
        nextBtn.textContent = 'Next ‚Üí';
        nextBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
        nextBtn.classList.add('btn-primary');
    }
}

// Next button
document.getElementById('next-btn').addEventListener('click', function() {
    if (currentQuestion < totalQuestions) {
        currentQuestion++;
        showQuestion(currentQuestion);
    } else {
        // Complete assessment
        document.getElementById('assessment-container').style.display = 'none';
        document.querySelector('.flex.justify-between').style.display = 'none';
        document.getElementById('completion-message').style.display = 'block';
    }
});

// Previous button
document.getElementById('prev-btn').addEventListener('click', function() {
    if (currentQuestion > 1) {
        currentQuestion--;
        showQuestion(currentQuestion);
    }
});

// Save Draft button
document.getElementById('save-draft-btn').addEventListener('click', function() {
    localStorage.setItem('careerAssessmentDraft', JSON.stringify(answers));
    alert('Your progress has been saved! You can continue later.');
});

// Get Results button
// Get Results button
document.getElementById('get-results-btn').addEventListener('click', function() {
    const formData = new FormData();
    for (let i = 1; i <= totalQuestions; i++) {
        formData.append(`answer_${i}`, answers[i] || '');
    }

    fetch("{% url 'career_assessment' %}", {
        method: "POST",
        body: formData,
        headers: {
            "X-CSRFToken": "{{ csrf_token }}",
        },
    })
    .then(response => response.text())
    .then(data => {
        document.getElementById('career-results').innerHTML = data;
    })
    .catch(err => alert('Error fetching recommendations'));
});


// Load saved draft
const savedDraft = localStorage.getItem('careerAssessmentDraft');
if (savedDraft) {
    const savedAnswers = JSON.parse(savedDraft);
    for (const [questionNum, answer] of Object.entries(savedAnswers)) {
        const textarea = document.getElementById(`answer-${questionNum}`);
        if (textarea) {
            textarea.value = answer;
            answers[questionNum] = answer;
            const charCount = document.getElementById(`char-count-${questionNum}`);
            if (charCount) charCount.textContent = answer.length;
        }
    }
}

    </script>
        
</html>
